<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Library v2.1</title>
       <link href="https://fonts.googleapis.com/css?family=Caveat|Montserrat:400,600&display=swap" rel="stylesheet">

  <style>
    body { font-family: Caveat, sans-serif; margin: 20px; background: #fafafa; }
    h1 { text-align: center; }
    .controls { text-align: center; margin-bottom: 20px; }
    .controls input, .controls button { margin: 5px; padding: 8px 12px; font-size: 14px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }
    .column { padding: 10px; border-radius: 8px; min-height: 200px; }
    .fiction { background: #d9ebff; }
    .nonfiction { background: #fff9d9; }
    .business { background: #d9ffe0; }
    .mathematics { background: #ffd9d9; }
    h2 { text-align: center; }
    .book {
      background: #fff; border: 1px solid #ccc; border-radius: 6px;
      padding: 10px; margin: 10px 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .book h3 { margin: 0; font-size: 16px; }
    .book p { margin: 4px 0; font-size: 13px; color: #333; }
    .notes { margin-top: 8px; }
    .note {
      background: #f0f0f0; padding: 6px; margin: 4px 0;
      border-radius: 4px; cursor: grab; display: flex; justify-content: space-between;
    }
    .note.dragging { opacity: 0.5; }
    .note .star, .note .delete { cursor: pointer; margin-left: 5px; }
    textarea { width: 95%; margin-top: 5px; font-size: 13px; }
  </style>
</head>
<body>
  <h1>üìö My Library v2.1</h1>

  <div class="controls">
    <input type="text" id="searchBar" placeholder="üîç Search books...">
    <button onclick="resetAllNotes()">Reset Notes</button>
    <button onclick="saveCSV()">Save as CSV</button>
  </div>

  <div class="grid">
    <!-- Fiction -->
    <div class="column fiction">
      <h2>Fiction</h2>
      <div class="book" data-title="Madame Bovary">
        <h3>Madame Bovary</h3><p>Novel by Gustave Flaubert</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Notes from Underground">
        <h3>Notes from Underground</h3><p>Novel by Fyodor Dostoevsky</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="The Merchant of Venice">
        <h3>The Merchant of Venice</h3><p>Play by William Shakespeare</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Jacques the Fatalist">
        <h3>Jacques the Fatalist</h3><p>Novel by Denis Diderot</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
    </div>

    <!-- Non-Fiction -->
    <div class="column nonfiction">
      <h2>Non-Fiction</h2>
      <div class="book" data-title="Fooled by Randomness">
        <h3>Fooled by Randomness</h3><p>The Hidden Role of Chance ‚Äì Nassim Nicholas Taleb</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Life 3.0">
        <h3>Life 3.0</h3><p>Being Human in the Age of AI ‚Äì Max Tegmark</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="A Beautiful Math">
        <h3>A Beautiful Math</h3><p>Game Theory ‚Äì Tom Siegfried</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="The Art of Game Design">
        <h3>The Art of Game Design</h3><p>The Book of Lenses ‚Äì Jesse Schell</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
    </div>

    <!-- Business -->
    <div class="column business">
      <h2>Business</h2>
      <div class="book" data-title="The Right Game">
        <h3>The Right Game</h3><p>Use Game Theory ‚Äì Brandenburger & Nalebuff</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="The Art of Strategy">
        <h3>The Art of Strategy</h3><p>Dixit & Nalebuff</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Economics">
        <h3>Economics: A Very Short Introduction</h3><p>Partha Dasgupta</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Macroeconomics">
        <h3>Macroeconomics</h3><p>N. Gregory Mankiw</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
    </div>

    <!-- Mathematics -->
    <div class="column mathematics">
      <h2>Mathematics</h2>
      <div class="book" data-title="Theory of Games and Economic Behavior">
        <h3>Theory of Games and Economic Behavior</h3><p>Von Neumann & Morgenstern</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Reinforcement Learning">
        <h3>Reinforcement Learning: An Introduction</h3><br><p>Sutton & Barto</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Introduction to Stochastic Dynamic Programming">
        <h3>Introduction to Stochastic Dynamic Programming</h3><p>Sheldon Ross</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
      <div class="book" data-title="Game Theory">
        <h3>Game Theory</h3><p>Maschler, Solan & Zamir</p>
        <div class="notes"></div>
        <textarea placeholder="Add note..."></textarea><br><button onclick="addNote(this)">Add</button>
      </div>
    </div>
  </div>

  <script>
    // Load notes from localStorage
    document.querySelectorAll('.book').forEach(book => {
      const title = book.dataset.title;
      const notesDiv = book.querySelector('.notes');
      const saved = JSON.parse(localStorage.getItem('notes_' + title) || '[]');
      saved.forEach(text => notesDiv.appendChild(createNoteEl(text, title)));
    });

    function addNote(btn) {
      const book = btn.closest('.book');
      const title = book.dataset.title;
      const textarea = book.querySelector('textarea');
      const text = textarea.value.trim();
      if (!text) return;
      const notesDiv = book.querySelector('.notes');
      const noteEl = createNoteEl(text, title);
      notesDiv.appendChild(noteEl);
      saveNotes(title);
      textarea.value = "";
    }

    function createNoteEl(text, title) {
      const div = document.createElement('div');
      div.className = 'note';
      div.draggable = true;
      div.innerHTML = `<span>${text}</span>
        <span>
          <button class="star">‚≠ê</button>
          <button class="delete">‚úñ</button>
        </span>`;
      div.querySelector('.star').onclick = () => {
        div.parentNode.prepend(div);
        saveNotes(title);
      };
      div.querySelector('.delete').onclick = () => {
        div.remove();
        saveNotes(title);
      };
      div.addEventListener('dragstart', () => div.classList.add('dragging'));
      div.addEventListener('dragend', () => {
        div.classList.remove('dragging');
        saveNotes(title);
      });
      div.parentNode?.addEventListener('dragover', e => {
        e.preventDefault();
        const dragging = document.querySelector('.dragging');
        if (!dragging) return;
        const afterEl = Array.from(div.parentNode.children).find(el =>
          e.clientY < el.getBoundingClientRect().top + el.offsetHeight / 2
        );
        if (afterEl) div.parentNode.insertBefore(dragging, afterEl);
        else div.parentNode.appendChild(dragging);
      });
      return div;
    }

    function saveNotes(title) {
      const notesDiv = document.querySelector(`.book[data-title="${title}"] .notes`);
      const texts = Array.from(notesDiv.children).map(n => n.querySelector('span').textContent);
      localStorage.setItem('notes_' + title, JSON.stringify(texts));
    }

    function resetAllNotes() {
      if (confirm("Clear ALL notes for all books?")) {
        document.querySelectorAll('.notes').forEach(n => n.innerHTML = "");
        Object.keys(localStorage).forEach(k => {
          if (k.startsWith("notes_")) localStorage.removeItem(k);
        });
      }
    }

    function saveCSV() {
      let rows = [["Book", "Note"]];
      document.querySelectorAll('.book').forEach(book => {
        const title = book.dataset.title;
        const notes = JSON.parse(localStorage.getItem('notes_' + title) || '[]');
        notes.forEach(n => rows.push([title, n]));
      });
      let csv = rows.map(r => r.map(v => `"${v}"`).join(",")).join("\n");
      let blob = new Blob([csv], { type: 'text/csv' });
      let a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "library_notes.csv";
      a.click();
    }

    // Search function
    document.getElementById('searchBar').addEventListener('input', e => {
      const q = e.target.value.toLowerCase();
      document.querySelectorAll('.book').forEach(book => {
        const title = book.querySelector('h3').textContent.toLowerCase();
        const desc = book.querySelector('p').textContent.toLowerCase();
        book.style.display = (title.includes(q) || desc.includes(q)) ? "" : "none";
      });
    });
  </script>
</body>
</html>
