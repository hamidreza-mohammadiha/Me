<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekly Crypto Decision Tree</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    :root{
      --bg:#0f1220; --panel:#151935; --muted:#9aa4bf; --text:#e8ecff; --accent:#7aa2ff; --ok:#4ade80; --warn:#f59e0b; --bad:#ef4444; --line:#2a2f52;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text);}
    h1{font-size:22px; margin:16px 0}
    .wrap{max-width:1400px; margin:0 auto; padding:12px}
    .board{display:grid; grid-template-columns: 1fr; gap:20px}
    @media(min-width:800px){.board{grid-template-columns: 350px 1fr}}
    .panel{background:var(--panel); border:1px solid #22284d; border-radius:16px; padding:14px; box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .muted{color:var(--muted); font-size:12px}
    label{display:block; font-size:13px; margin-bottom:6px; color:#c7cff5}
    select, input[type="number"]{width:100%; background:#0e1230; border:1px solid #2a2f52; color:var(--text); border-radius:10px; padding:8px 10px; outline:none; margin-bottom:8px}
    select:focus, input:focus{border-color:var(--accent)}
    .btn{background:linear-gradient(90deg,#6d8cff,#7aa2ff); color:#05122a; border:none; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700; margin:5px 0;}
    .btn:active{transform:translateY(1px)}
    .out{white-space:pre-wrap; font-family: monospace; background:#0b0f26; border:1px dashed #2a2f52; border-radius:12px; padding:10px; font-size:13px}
    .footer{opacity:.8; font-size:12px; margin-top:8px}
    .tree-container{width:100%; height:400px; background:#0b0f26; border-radius:16px; padding:10px}
    .chart-container{width:100%; height:300px; background:#0b0f26; border-radius:16px; margin-top:12px;}
  </style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <h1>Weekly Crypto Decision Tree Â· From Gold to Entry/Exit</h1>
    <button class="btn" id="updateTree">Update Tree</button>
    <button class="btn" id="calcAlloc">Calculate Allocation</button>
  </div>

  <div class="board">
    <!-- LEFT: Inputs -->
    <section class="panel">
      <h3>1) Analytical Inputs</h3>
      <label>1. Global Gold Trend</label>
      <select id="gold"><option value="sideways">Sideways</option><option value="up">Up</option><option value="down">Down</option></select>

      <label>2. Total Market Cap</label>
      <select id="total"><option value="sideways">Sideways</option><option value="up">Up</option><option value="down">Down</option></select>

      <label>3. USDT Dominance (USDT.D)</label>
      <select id="usdtd"><option value="sideways">Sideways</option><option value="up">Up (Risk-off)</option><option value="down">Down (Risk-on)</option></select>

      <label>4. Bitcoin Trend</label>
      <select id="btc"><option value="range">Range</option><option value="up">Up</option><option value="down">Down</option><option value="breakout">Breakout Up</option><option value="breakdown">Breakdown Down</option></select>

      <label>5. Ethereum Strength (ETH vs BTC)</label>
      <select id="eth"><option value="neutral">Neutral</option><option value="strong">Strong</option><option value="weak">Weak</option></select>

      <label>6. Total3 (Excluding BTC & ETH)</label>
      <select id="total3"><option value="sideways">Sideways</option><option value="up">Up</option><option value="down">Down</option></select>

      <label>7. Others Dominance</label>
      <select id="othersd"><option value="sideways">Sideways</option><option value="up">Up</option><option value="down">Down</option></select>

      <label>ATR/Stop Loss Distance (%)</label>
      <input id="atrp" type="number" step="0.1" min="0" value="3">
      <label>Total Equity (USDT)</label>
      <input id="equity" type="number" step="1" min="0" value="1000">
      <label>Target Risk per Trade (%)</label>
      <input id="riskp" type="number" step="0.1" min="0" value="1">
    </section>

    <!-- RIGHT: Tree and Outputs -->
    <section class="panel">
      <h3>2) Decision Tree</h3>
      <div class="tree-container" id="tree"></div>

      <h3>Weekly Summary</h3>
      <div id="summary" class="out"></div>
      <div class="chart-container" id="pie"></div>
      <div class="footer">Educational tool only. Not financial advice.</div>
    </section>
  </div>
</div>

<script>
let svgTree;

function buildTree(){
  document.getElementById('tree').innerHTML="";
  const data = {
    name: "Market Analysis",
    children: [
      { name: "Gold", children: [{name:"Up"},{name:"Down"},{name:"Sideways"}]},
      { name: "Total Market Cap", children: [{name:"Up"},{name:"Down"},{name:"Sideways"}]},
      { name: "USDT.D", children: [{name:"Up (Risk-off)"},{name:"Down (Risk-on)"}]},
      { name: "Bitcoin", children: [{name:"Up"},{name:"Down"},{name:"Breakout"},{name:"Breakdown"}]},
      { name: "Ethereum", children: [{name:"Strong"},{name:"Weak"}]},
      { name: "Total3", children: [{name:"Up"},{name:"Down"}]},
      { name: "Others Dominance", children: [{name:"Up"},{name:"Down"}]},
      { name: "Decision", children: [
        {name:"Choose Crypto (Long/Short)"},
        {name:"Leverage & Margin"},
        {name:"Entry Point"},
        {name:"Exit Point"}
      ]}
    ]
  };

  const width = document.getElementById('tree').clientWidth;
  const height = document.getElementById('tree').clientHeight;

  const svg = d3.select("#tree").append("svg")
    .attr("width", width)
    .attr("height", height);

  svgTree = svg.append("g").attr("transform","translate(40,40)");

  const treeLayout = d3.tree().size([height-80, width-160]);
  const root = d3.hierarchy(data);
  treeLayout(root);

  svgTree.selectAll('.link')
    .data(root.links())
    .enter().append('path')
    .attr('fill','none')
    .attr('stroke','#7aa2ff')
    .attr('stroke-width',1.5)
    .attr('d', d3.linkHorizontal().x(d=>d.y).y(d=>d.x));

  svgTree.selectAll('.node')
    .data(root.descendants())
    .enter().append('circle')
    .attr('cx', d=>d.y)
    .attr('cy', d=>d.x)
    .attr('r',6)
    .attr('fill', d=> decisionColor(d.data.name));

  svgTree.selectAll('.label')
    .data(root.descendants())
    .enter().append('text')
    .attr('x', d=>d.y+10)
    .attr('y', d=>d.x+4)
    .attr('fill','#e8ecff')
    .style('font-size','12px')
    .text(d=>d.data.name);
}

function decisionColor(name){
  if(["Choose Crypto (Long/Short)","Leverage & Margin","Entry Point","Exit Point"].includes(name)){
    return "#4ade80";
  }
  if(name.toLowerCase().includes("down") || name.toLowerCase().includes("risk")){
    return "#ef4444";
  }
  if(name.toLowerCase().includes("up") || name.toLowerCase().includes("strong")){
    return "#22c55e";
  }
  return "#7aa2ff";
}

function calculateAllocation(){
  const gold = document.getElementById('gold').value;
  const total = document.getElementById('total').value;
  const usdtd = document.getElementById('usdtd').value;
  const btc = document.getElementById('btc').value;
  const eth = document.getElementById('eth').value;
  const total3 = document.getElementById('total3').value;
  const othersd = document.getElementById('othersd').value;
  const equity = +document.getElementById('equity').value;

  // Financial logic heuristic:
  let goldW=0.2, btcW=0.3, ethW=0.25, altW=0.25;

  if(gold==="up") goldW+=0.1; else if(gold==="down") goldW-=0.1;
  if(total==="up") {btcW+=0.05; ethW+=0.05; altW+=0.1;} else if(total==="down") {goldW+=0.05; btcW-=0.05; altW-=0.05;}
  if(usdtd.includes("up")) {goldW+=0.1; altW-=0.1;} else if(usdtd.includes("down")) {altW+=0.1;}
  if(btc==="up"||btc==="breakout") btcW+=0.1; if(btc==="down"||btc==="breakdown") btcW-=0.1;
  if(eth==="strong") ethW+=0.1; if(eth==="weak") ethW-=0.1;
  if(total3==="up") altW+=0.1; if(total3==="down") altW-=0.1;
  if(othersd==="up") altW+=0.05; if(othersd==="down") altW-=0.05;

  let weights=[goldW, btcW, ethW, altW];
  const sum=weights.reduce((a,b)=>a+b,0);
  weights=weights.map(w=>w/sum);

  const values=[weights[0]*equity, weights[1]*equity, weights[2]*equity, weights[3]*equity];
  const labels=["Gold","BTC","ETH","Altcoins"];

  drawPie(labels, values);
}

function drawPie(labels, values){
  document.getElementById('pie').innerHTML="";
  const width=document.getElementById('pie').clientWidth;
  const height=document.getElementById('pie').clientHeight;
  const radius=Math.min(width,height)/2-20;

  const svg=d3.select('#pie').append('svg').attr('width',width).attr('height',height)
    .append('g').attr('transform',`translate(${width/2},${height/2})`);

  const color=d3.scaleOrdinal().domain(labels).range(["#facc15","#22c55e","#3b82f6","#a855f7"]);

  const pie=d3.pie();
  const data_ready=pie(values);

  svg.selectAll('path').data(data_ready).enter().append('path')
    .attr('d',d3.arc().innerRadius(0).outerRadius(radius))
    .attr('fill',(d,i)=>color(labels[i]))
    .attr('stroke','#0f1220').style('stroke-width','2px');

  svg.selectAll('text').data(data_ready).enter().append('text')
    .text((d,i)=>labels[i]+": $"+values[i].toFixed(0))
    .attr('transform',d=>`translate(${d3.arc().innerRadius(0).outerRadius(radius*0.6).centroid(d)})`)
    .style('text-anchor','middle').style('fill','#fff').style('font-size','12px');
}

// Events
buildTree();
document.getElementById('updateTree').addEventListener('click', buildTree);
document.getElementById('calcAlloc').addEventListener('click', calculateAllocation);
</script>
</body>
</html>
