<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BTC Scenario Simulator (Sep 22, 2025 ‚Üí Jan 1, 2026)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Chart.js + time scale adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
  <style>
    :root{
      --bg:#0f1220; --panel:#151a2e; --ink:#e9ecf5; --muted:#9aa3b2;
      --accent:#7dd3fc; --accent2:#c084fc; --good:#34d399; --bad:#f87171;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:var(--ink); background: radial-gradient(1200px 700px at 10% -10%, #1b2140, #0f1220 60%);
      min-height:100vh; display:flex; flex-direction:column;
    }
    header, footer{
      background:linear-gradient(90deg, #12172b, #161b31);
      border-bottom:1px solid #222948; border-top:1px solid #222948;
      padding:16px 20px;
    }
    header h1{ margin:0; font-size:20px; letter-spacing:.3px }
    header p{ margin:6px 0 0; color:var(--muted); font-size:13px }
    main{ width:100%; max-width:1100px; margin:22px auto; padding:0 16px; flex:1; }
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid #232a4b; border-radius:14px; padding:18px; box-shadow:10px 10px 28px rgba(0,0,0,.25);
    }
    .panel.chart { height: 720px; display:flex; flex-direction:column; }
    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:12px 0 8px;
    }
    .controls select, .controls button, .controls input{
      padding:10px 12px; border-radius:10px; border:1px solid #2a335c; background:#121731; color:var(--ink);
      outline:none; transition:transform .06s ease, border .2s;
    }
    .controls input[type="number"]{ width:90px; }
    .controls select:focus, .controls button:focus, .controls input:focus{ border-color:#3b4b8f }
    .controls button:hover{ transform:translateY(-1px); cursor:pointer; }
    .controls button.play{ border-color:#1f8cff; }
    .controls button.pause{ border-color:#ffbf69; }
    .controls button.reset{ border-color:#5eead4; }
    .controls button.reroll{ border-color:#c084fc; }
    .kbd{
      font:12px/1.3 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      background:#0e1326; border:1px solid #2a335c; padding:2px 6px; border-radius:6px; color:#c3cdf7;
    }
    .grid{ display:grid; grid-template-columns: 1.3fr .7fr; gap:18px; }
    @media (max-width: 920px){ .grid{ grid-template-columns:1fr; } }
    .desc h2{ margin:4px 0 6px; font-size:16px }
    .desc p{ margin:0 0 12px; color:var(--muted) }
    ul.scenarios{ margin:8px 0 0 1.2rem; padding:0; color:var(--muted) }
    ul.scenarios li{ margin:6px 0 }
    canvas{ background:#0c1122; border:1px solid #232a4b; border-radius:12px; flex:1; }
    .legend-dot{ display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; transform:translateY(1px); }
    footer{ color:var(--muted); font-size:12px; }
    footer a{ color:#b7c5ff; text-decoration:none }
    footer a:hover{ text-decoration:underline }
    .pill{ display:inline-block; padding:4px 8px; border:1px solid #26305e; background:#0c132b; border-radius:999px; color:#c9d3ff; font-size:12px; }
  </style>
</head>
<body>
  <header>
    <h1>Bitcoin Scenario Simulator ‚Äî Sep 22, 2025 ‚Üí Jan 1, 2026</h1>
    <p>
      Start price: <span class="pill">$112,550</span> ¬∑ 60-second playback ¬∑ Choose a scenario and <span class="kbd">Play</span>.
    </p>
  </header>

  <main>
    <div class="grid">
      <div class="panel chart">
        <canvas id="chart"></canvas>
        <div class="controls">
          <label for="scenario"><strong>Scenario:</strong></label>
          <select id="scenario">
            <option value="optimistic">Optimistic</option>
            <option value="realistic" selected>Realistic</option>
            <option value="pessimistic">Pessimistic</option>
          </select>

          <label for="paths"><strong>Realizations:</strong></label>
          <input id="paths" type="number" min="1" max="21" step="1" value="2" title="Number of random paths" />

          <button class="reroll" id="btnReroll">üé≤ Reroll</button>
          <button class="play" id="btnPlay">‚ñ∂ Play</button>
          <button class="pause" id="btnPause">‚è∏ Pause</button>
          <button class="reset" id="btnReset">‚ü≤ Reset</button>

          <span style="margin-left:auto; color:var(--muted);">Frames: <span id="frameCount">0</span>/<span id="frameTotal">0</span></span>
        </div>
      </div>

      <div style="width: 150%" class="panel desc">
        <h2>About this page</h2>
        <p>
          This simulator renders an <em>ensemble</em> of price paths per scenario using a geometric-Brownian-like process
          (drift + volatility) from <strong>Sep 22, 2025</strong> through <strong>Jan 1, 2026</strong>.
          It animates one day per frame (~30 seconds total). The shaded area shows the <strong>10‚Äì90% band</strong>.
        </p>
        <h2>Scenario assumptions</h2>
        <ul class="scenarios">
          <li><span class="legend-dot" style="background:var(--good)"></span><strong>Optimistic</strong> ‚Äî net drift ‚âà <em>+35%</em>, relatively low daily volatility.</li>
          <li><span class="legend-dot" style="background:var(--accent)"></span><strong>Realistic</strong> ‚Äî net drift ‚âà <em>+10%</em>, moderate volatility.</li>
          <li><span class="legend-dot" style="background:var(--bad)"></span><strong>Pessimistic</strong> ‚Äî net drift ‚âà <em>‚àí20%</em>, higher volatility.</li>
        </ul>
        <p style="margin-top:10px">
          <em>Context:</em> BTC recently traded near <strong>$112K</strong> with the year‚Äôs largest long-side liquidations and macro catalysts in focus; traders debated $100K retests vs rebounds.
        </p>
        <p style="font-size:12px; color:var(--muted)">
          Illustrative only, not financial advice. Paths are randomized per reroll.
        </p>
      </div>
    </div>
  </main>

  <footer>
    Cross-checked with Cointelegraph‚Äôs weekly wrap on the big liquidation and macro focus.
    <a href="https://cointelegraph.com/news/biggest-liquidation-of-2025-5-things-bitcoin-this-week" target="_blank" rel="noopener">Read source</a>.
  </footer>

  <script>
    // ------- Parameters -------
    const START_PRICE = 112550; // user-provided
    const START_DATE = new Date('2025-09-22T00:00:00Z');
    const END_DATE   = new Date('2026-01-01T00:00:00Z');

    const DAY_MS = 24*60*60*1000;
    const totalDays = Math.round((END_DATE - START_DATE) / DAY_MS) + 1;
    const FRAME_INTERVAL_MS = Math.max(16, Math.round(30000 / totalDays)); // ~30s total

    // Seeded RNG
    function mulberry32(a){ return function(){ let t = a += 0x6D2B79F5; t = Math.imul(t ^ t>>>15, t | 1); t ^= t + Math.imul(t ^ t>>>7, t | 61); return ((t ^ t>>>14) >>> 0) / 4294967296; } }
    function normal01(rand){ // Box‚ÄìMuller
      const u = Math.max(rand(), 1e-12), v = Math.max(rand(), 1e-12);
      return Math.sqrt(-2*Math.log(u)) * Math.cos(2*Math.PI*v);
    }

    const scenarios = {
      optimistic: { label: "Optimistic", baseColor: "#34d399", bandColor: "rgba(52,211,153,0.18)", seed: 1337, driftTotal: 0.35, dailyVol: 0.015 },
      realistic:  { label: "Realistic",  baseColor: "#7dd3fc", bandColor: "rgba(125,211,252,0.18)", seed: 4242, driftTotal: 0.10, dailyVol: 0.020 },
      pessimistic:{ label: "Pessimistic",baseColor: "#f87171", bandColor: "rgba(248,113,113,0.18)", seed: 2025, driftTotal:-0.20, dailyVol: 0.025 }
    };

    // ------- Path generation -------
    // One GBM-like path (returns arrays of Date & price)
    function generatePath(seed, driftTotal, dailyVol){
      const rand = mulberry32(seed);
      const days = totalDays;
      const dt = 1/365;
      const mu_window = Math.log(1 + driftTotal);
      const mu_daily = mu_window / days;

      let t = new Date(START_DATE);
      let price = START_PRICE;
      const labels = new Array(days);
      const data = new Array(days);
      for(let i=0;i<days;i++){
        labels[i] = new Date(t);
        data[i] = price;
        const z = normal01(rand);
        const sigma = dailyVol * Math.sqrt(365);
        const drift = (mu_daily - 0.5*(sigma**2)*dt);
        const shock = sigma*Math.sqrt(dt)*z;
        price = price * Math.exp(drift + shock);
        t = new Date(t.getTime() + DAY_MS);
      }
      return { labels, data };
    }

    // Generate ensemble of N paths + percentiles (10/90)
    function generateEnsemble(scn, nPaths, seedBump=0){
      const { seed, driftTotal, dailyVol } = scn;
      const paths = [];
      let labels = null;
      for(let i=0;i<nPaths;i++){
        const p = generatePath(seed + seedBump + i*997, driftTotal, dailyVol);
        if(!labels) labels = p.labels;
        paths.push(p.data);
      }
      // Compute percentiles per day
      const p10 = [], p90 = [];
      for(let d=0; d<labels.length; d++){
        const vals = paths.map(a => a[d]).sort((a,b)=>a-b);
        const q = (arr, q) => {
          const pos = (arr.length-1)*q;
          const base = Math.floor(pos), rest = pos - base;
          return arr[base] + (arr[base+1] - arr[base]) * (isNaN(rest)?0:rest);
        };
        p10.push(q(vals, 0.10));
        p90.push(q(vals, 0.90));
      }
      return { labels, paths, p10, p90 };
    }

    // ------- Chart setup -------
    const ctx = document.getElementById('chart').getContext('2d');
    let activeKey = 'realistic';
    let nRealizations = 2;
    let seedBump = 0; // changes on reroll for fresh randomness

    let ensemble = generateEnsemble(scenarios[activeKey], nRealizations, seedBump);

    // Build datasets: [bandLow, bandHigh(fill to prev), path1..pathN]
    function buildDatasets(scn, ens){
      const base = scn.baseColor, bandBg = scn.bandColor;

      const ds = [];
      // Band low first (no fill)
      ds.push({
        label: "10th pct",
        data: [{x: ens.labels[0], y: ens.p10[0]}],
        borderColor: 'rgba(0,0,0,0)',
        backgroundColor: 'transparent',
        pointRadius: 0, borderWidth: 0, tension: 0.2
      });
      // Band high second, fill to previous
      ds.push({
        label: "90th pct",
        data: [{x: ens.labels[0], y: ens.p90[0]}],
        borderColor: 'rgba(0,0,0,0)',
        backgroundColor: bandBg,
        fill: '-1',
        pointRadius: 0, borderWidth: 0, tension: 0.2
      });
      // Individual paths
      const alphaLine = 0.5;
      for(let i=0;i<ens.paths.length;i++){
        ds.push({
          label: `${scn.label} path #${i+1}`,
          data: [{x: ens.labels[0], y: ens.paths[i][0]}],
          borderColor: base,
          backgroundColor: "transparent",
          borderWidth: 1.6,
          pointRadius: 0,
          tension: 0.22,
          hidden: false,
          parsing: false
        });
      }
      return ds;
    }

    const chart = new Chart(ctx, {
      type: 'line',
      data: { datasets: buildDatasets(scenarios[activeKey], ensemble) },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        scales: {
          x: { type: 'time', time: { unit: 'day' }, grid: { color: 'rgba(255,255,255,0.05)' }, ticks:{ color:'#c7d2fe' } },
          y: { grid: { color: 'rgba(255,255,255,0.06)' }, ticks:{ color:'#c7d2fe',
                callback: v => '$' + Math.round(v).toLocaleString() } }
        },
        plugins: {
          legend: { labels: { color: '#dbeafe' } },
          tooltip: {
            mode: 'nearest', intersect:false,
            callbacks: { label: ctx => ` ${ctx.dataset.label}: $${Math.round(ctx.parsed.y).toLocaleString()}` }
          }
        }
      }
    });

    // ------- Animation control -------
    let timer = null;
    let frame = 1; // we already plotted index 0
    const frameTotalEl = document.getElementById('frameTotal');
    const frameCountEl = document.getElementById('frameCount');
    frameTotalEl.textContent = (ensemble.labels.length - 1).toString();

    function pushFrameToDatasets(idx){
      // ds[0] = p10; ds[1] = p90; rest = paths
      chart.data.datasets[0].data.push({x: ensemble.labels[idx], y: ensemble.p10[idx]});
      chart.data.datasets[1].data.push({x: ensemble.labels[idx], y: ensemble.p90[idx]});
      for(let i=0;i<ensemble.paths.length;i++){
        chart.data.datasets[2+i].data.push({x: ensemble.labels[idx], y: ensemble.paths[i][idx]});
      }
    }

    function step(){
      if(frame >= ensemble.labels.length){ pause(); return; }
      pushFrameToDatasets(frame);
      chart.update();
      frameCountEl.textContent = frame.toString();
      frame++;
    }
    function play(){ if(!timer) timer = setInterval(step, FRAME_INTERVAL_MS); }
    function pause(){ if(timer){ clearInterval(timer); timer = null; } }
    function reset(){
      pause(); frame = 1;
      // Rebuild datasets at first point only
      chart.data.datasets = buildDatasets(scenarios[activeKey], ensemble);
      chart.update();
      frameTotalEl.textContent = (ensemble.labels.length - 1).toString();
      frameCountEl.textContent = '0';
    }

    function setScenario(key){
      activeKey = key;
      ensemble = generateEnsemble(scenarios[activeKey], nRealizations, seedBump);
      reset();
    }
    function setPaths(n){
      nRealizations = Math.max(1, Math.min(10, parseInt(n||'2', 10)));
      ensemble = generateEnsemble(scenarios[activeKey], nRealizations, seedBump);
      reset();
    }
    function reroll(){
      seedBump = Math.floor(Math.random() * 1e9);
      ensemble = generateEnsemble(scenarios[activeKey], nRealizations, seedBump);
      reset();
    }

    // ------- Wire up UI -------
    document.getElementById('btnPlay').addEventListener('click', play);
    document.getElementById('btnPause').addEventListener('click', pause);
    document.getElementById('btnReset').addEventListener('click', reset);
    document.getElementById('btnReroll').addEventListener('click', reroll);
    document.getElementById('scenario').addEventListener('change', (e)=> setScenario(e.target.value));
    document.getElementById('paths').addEventListener('change', (e)=> setPaths(e.target.value));

    // Start paused with initial first points set
    reset();
  </script>
</body>
</html>
